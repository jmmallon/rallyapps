<!DOCTYPE html>
<html>
<head>
    <title>RallyGrid</title>

    <script type="text/javascript" src="/apps/2.0rc2/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){this._loadData()},_loadData:function(){var programs=["CGCS","VxWorks ST","IOT","Networking","OVP","Linux","VxWorks 653 3.0","VxWorks 7","Tools"],projects=Ext.create("Ext.util.HashMap");projects.add("13538110755","CGCS"),projects.add("15267702952","VxWorks ST"),projects.add("10479834443","IOT"),projects.add("13420058203","IOT"),projects.add("9740387440","Networking"),projects.add("13245546162","Networking"),projects.add("10957142069","OVP"),projects.add("11470176273","Linux"),projects.add("13744307332","VxWorks 653 3.0"),projects.add("10253738811","VxWorks 7"),projects.add("11490173498","VxWorks 7"),projects.add("11424999507","VxWorks 7"),projects.add("11490019566","VxWorks 7"),projects.add("11424998698","VxWorks 7"),projects.add("12890367855","VxWorks 7"),projects.add("12405728916","Tools"),projects.add("12868082229","Tools"),projects.add("15106843053","Tools"),projects.add("12168776634","Tools");var today=Rally.util.DateTime.toIsoString(new Date),releaseDateFilter=Ext.create("Rally.data.wsapi.Filter",{property:"ReleaseDate",operator:">=",value:today}),releaseDatesFilter=releaseDateFilter.and(Ext.create("Rally.data.wsapi.Filter",{property:"ReleaseStartDate",operator:"<=",value:today}));Ext.create("Rally.data.wsapi.Store",{model:"Release",fetch:["FormattedID","Name","ReleaseDate","ReleaseStartDate"],limit:1/0,context:{project:"/project/11089755042",projectScopeDown:!0},filters:releaseDatesFilter,autoLoad:!0,listeners:{load:function(myStore,myData,mySuccess){console.log("Loaded release data: "+myStore.data.length);var releases=Ext.create("Ext.util.HashMap");Ext.Array.each(myStore.getRecords(),function(release){releases.add(release.get("_ref"),[release.get("ReleaseStartDate"),release.get("ReleaseDate")])}),Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Feature",fetch:["FormattedID","Name","Release","Project","State","c_PATracking","UserStories"],limit:1/0,context:{project:"/project/11089755042",projectScopeDown:!0},autoLoad:!0,listeners:{load:function(myStore,myData,mySuccess){console.log("Loaded feature data: "+myStore.data.length);var total=Ext.create("Ext.util.HashMap"),reviewed=Ext.create("Ext.util.HashMap"),validated=Ext.create("Ext.util.HashMap"),hld=Ext.create("Ext.util.HashMap"),hldgreenlit=Ext.create("Ext.util.HashMap");Ext.Array.each(myStore.getRecords(),function(feature){var featureRelease=feature.get("Release");if(null!==featureRelease){var featureReleaseRef=featureRelease._ref;if(releases.get(featureReleaseRef)){var featureProject=feature.get("Project"),featureProjectRef=featureProject._ref,featureProjectRefID=featureProjectRef.split("/").pop();if(projects.get(featureProjectRefID)){var program=projects.get(featureProjectRefID);if(total.get(program)){var totalTmp=total.get(program);totalTmp++,total.replace(program,totalTmp)}else total.add(program,1);var featureTracking=feature.get("c_PATracking");if("Review"==featureTracking)if(reviewed.get(program)){var reviewedTmp=reviewed.get(program);reviewedTmp++,reviewed.replace(program,reviewedTmp)}else reviewed.add(program,1);var featureState=feature.get("State");if(null!==featureState&&(featureStateName=featureState._refObjectName,"Done"==featureStateName))if(validated.get(program)){var validatedTmp=validated.get(program);validatedTmp++,validated.replace(program,validatedTmp)}else validated.add(program,1)}}}}),Ext.define("featureData",{extend:"Ext.data.Model",fields:[{name:"program",type:"string"},{name:"total",type:"int"},{name:"reviewed",type:"int"},{name:"validated",type:"int"},{name:"hld",type:"int"},{name:"hldgreenlit",type:"int"}]});var featureStore=Ext.create("Ext.data.Store",{model:featureData,sorters:[{property:"program",direction:"ASC"}]});for(i=0;programs.length>i;i++){var programTmp=programs[i],totalTmp=0,reviewedTmp=0,validatedTmp=0;total.get(programTmp)&&(totalTmp=total.get(programTmp)),reviewed.get(programTmp)&&(reviewedTmp=reviewed.get(programTmp)),validated.get(programTmp)&&(validatedTmp=validated.get(programTmp)),featureStore.add({program:programTmp,total:totalTmp,reviewed:reviewedTmp,validated:validatedTmp})}console.log(featureStore),this._loadGrid(featureStore)},scope:this}})},scope:this}})},_loadGrid:function(myStore){var myGrid=Ext.create("Ext.grid.Panel",{title:"PT Dashboard",store:myStore,columns:[{text:"Program",dataIndex:"program"},{text:"Total Features",dataIndex:"total"},{text:"Reviewed Features",dataIndex:"reviewed"},{text:"Validated Features",dataIndex:"validated"},{text:"HLDs",dataIndex:"hld"},{text:"Green-lit HLDs",dataIndex:"hldgreenlit"}]});console.log("myStore: "+myStore.data.length),console.log(myStore),this.add(myGrid)}});

            Rally.launchApp('CustomApp', {
                name:"RallyGrid",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
